(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27f7d111","chunk-2d0dd0fb"],{"0a99":function(e,r,t){"use strict";t.d(r,"d",(function(){return i})),t.d(r,"a",(function(){return n})),t.d(r,"e",(function(){return s})),t.d(r,"c",(function(){return u})),t.d(r,"b",(function(){return l}));var o=t("b775"),a=t("ca00");function i(e){return Object(o["a"])({url:"/v1/activity/groupActivities/_search",method:"post",data:e})}function n(e){return Object(o["a"])({url:"/v1/activity/groupActivities",method:"post",data:e})}function s(e){return Object(o["a"])({url:"/v1/activity/groupActivities/".concat(e.id),method:"put",data:e})}function u(e){return Object(o["a"])({url:"/v1/store/list",method:"post",data:e}).then((function(e){return Object(a["g"])(e)}))}function l(e){return Object(o["a"])({url:"/v1/product/list",method:"post",data:e}).then((function(e){return Object(a["g"])(e)}))}},"807d":function(e,r,t){"use strict";t.r(r),t.d(r,"defaultForm",(function(){return i})),t.d(r,"rules",(function(){return n}));var o=t("c1df"),a=t.n(o),i=(t("ca00"),{name:"",pt_huodong_shijian:[a()().set("hour",0).set("minute",0).set("second",0),a()().set("hour",23).set("minute",59).set("second",59)],day:1,hour:0,minute:0,stores:[],restriction:[1,2],eventPurchase:1,epNumber:void 0,superimposed:1,product:[],peopleNumber:void 0,groupPrice:void 0,commissary:1,pt_huiyuan_pay_bili:void 0,pt_weixin_pay_bili:void 0,pt_huiyuan_pay_yuan:void 0,pt_weixin_pay_yuan:void 0,paymentMethod:[1,2]});function n(e){return{name:[{required:!0,message:"活动名称不能为空",trigger:"blur"},{min:2,message:"字数不能少于2个字",trigger:"blur"},{max:30,message:"字数不能超过30个字",trigger:"blur"}],pt_huodong_shijian:[{required:!0,message:"请选择",trigger:"blur"}],pt_tuan_youxiaoqi:[{required:!0,validator:function(r,t,o){var a=e.form,i=a.day,n=a.hour,s=a.minute;i||n||s?24*i*60+60*n+s<60?o(new Error("团有效期不能小于1小时")):o():o(new Error("团有效期不能为0"))},trigger:"blur"}],stores:[{required:!0,validator:function(r,t,o){e.form.stores.length?o():o(new Error("请选择适用门店"))},trigger:"blur"}],restriction:[{required:!0,validator:function(r,t,o){e.form.restriction.length?o():o(new Error("至少选一个"))},trigger:"blur"}],epNumber:[{required:!0,validator:function(r,t,o){2!==e.form.eventPurchase||e.form.epNumber?o():o(new Error("请填写限购数量，且必须为大于0的整数"))},trigger:"blur"}],superimposed:[{required:!0,validator:function(e,r,t){return t()},trigger:"blur"}],paymentMethod:[{required:!0,validator:function(r,t,o){e.form.paymentMethod.length?o():o(new Error("至少选一个"))},trigger:"blur"}],product:[{required:!0,validator:function(r,t,o){e.form.product.length?o():o(new Error("请选择活动项目"))},trigger:"blur"}],groupPrice:[{required:!0,validator:function(r,t,o){if(e.form.product.length){if(!e.form.peopleNumber)return e.$refs.groupPrice2.$el.style.borderColor="#d9d9d9",e.$refs.groupPrice1.$el.style.borderColor="#f5222d",o(new Error("人数请输入2-10的整数"));if(!e.form.groupPrice)return e.$refs.groupPrice1.$el.style.borderColor="#d9d9d9",e.$refs.groupPrice2.$el.style.borderColor="#f5222d",o(new Error("拼团价必须大于0"));if(e.form.groupPrice>=e.form.product[0].price)return e.$refs.groupPrice1.$el.style.borderColor="#d9d9d9",e.$refs.groupPrice2.$el.style.borderColor="#f5222d",o(new Error("拼团价必须小于原售价"));e.$refs.groupPrice1.$el.style.borderColor="#d9d9d9",e.$refs.groupPrice2.$el.style.borderColor="#d9d9d9",o()}else o()},trigger:"blur"}],commissary:[{required:!0,validator:function(r,t,o){var a=e.form,i=a.commissary,n=a.pt_huiyuan_pay_bili,s=a.pt_weixin_pay_bili,u=a.pt_huiyuan_pay_yuan,l=a.pt_weixin_pay_yuan;"固定比例value"===i?n||s?o():o(new Error("固定比例不能全为0")):"固定金额value"===i?u||l?o():o(new Error("固定金额不能全为0")):o()},trigger:"blur"}]}}},9378:function(e,r,t){"use strict";t.r(r);var o=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("BaseCard",{attrs:{title:"活动基础信息"}},[t("a-form-model",{ref:"ruleForm",attrs:{rules:e.rules,model:e.form,"label-col":{span:6},"wrapper-col":{span:16}}},[t("a-form-model-item",{attrs:{label:"活动名称",prop:"name"}},[t("a-input",{attrs:{placeholder:"作为标题在页面上展示，长度为2到30字",disabled:e.disabled},model:{value:e.form.name,callback:function(r){e.$set(e.form,"name",r)},expression:"form.name"}})],1),t("a-form-model-item",{attrs:{label:"活动时间",prop:"pt_huodong_shijian"}},[t("a-range-picker",{attrs:{placeholder:["请选择生效时间","请选择过期时间"],format:"YYYY-MM-DD HH:mm:ss","show-time":"",disabled:e.disabled},model:{value:e.form.pt_huodong_shijian,callback:function(r){e.$set(e.form,"pt_huodong_shijian",r)},expression:"form.pt_huodong_shijian"}})],1),t("a-form-model-item",{ref:"pt_tuan_youxiaoqi",staticClass:"pt_tuan_youxiaoqi",attrs:{label:"团有效期",prop:"pt_tuan_youxiaoqi"}},[t("a-input-number",{attrs:{min:0,max:15,disabled:e.disabled},model:{value:e.form.day,callback:function(r){e.$set(e.form,"day",r)},expression:"form.day"}}),e._v("天 "),t("a-input-number",{attrs:{min:0,max:23,disabled:e.disabled},on:{blur:function(){return e.$refs.pt_tuan_youxiaoqi.onFieldBlur()}},model:{value:e.form.hour,callback:function(r){e.$set(e.form,"hour",r)},expression:"form.hour"}}),e._v("时 "),t("a-input-number",{attrs:{min:0,max:59,disabled:e.disabled},on:{blur:function(){return e.$refs.pt_tuan_youxiaoqi.onFieldBlur()}},model:{value:e.form.minute,callback:function(r){e.$set(e.form,"minute",r)},expression:"form.minute"}}),e._v("分 ")],1),t("a-form-model-item",{ref:"stores",attrs:{label:"适用门店",prop:"stores"}},[t("a-button",{attrs:{type:"link",disabled:e.disabled},on:{click:e.selectStore}},[e._v("选择门店")]),e._v("已选"),t("span",{staticClass:"red"},[e._v(e._s(e.form.stores.length))]),e._v("家门店 "),e.form.stores.length?t("a-table",{ref:"table",attrs:{rowKey:"id",columns:e.columnsStore,dataSource:e.form.stores,pagination:!1,size:"small",scroll:{y:185}},scopedSlots:e._u([{key:"action",fn:function(r,o,a){return t("span",{},[[t("a-button",{attrs:{type:"link",disabled:e.disabled},on:{click:function(r){return e.deleteStore(a)}}},[e._v(" 删除 ")])]],2)}}],null,!1,4055045854)}):e._e()],1),t("a-form-model-item",{attrs:{label:"参团限制",prop:"restriction"}},[t("a-checkbox-group",{attrs:{disabled:e.disabled},model:{value:e.form.restriction,callback:function(r){e.$set(e.form,"restriction",r)},expression:"form.restriction"}},[t("a-checkbox",{attrs:{value:1}},[e._v(" 会员 ")]),t("a-checkbox",{attrs:{value:2}},[e._v(" 散客 ")])],1)],1),t("a-form-model-item",{attrs:{label:"活动限购",prop:"epNumber"}},[t("a-radio-group",{attrs:{disabled:e.disabled},model:{value:e.form.eventPurchase,callback:function(r){e.$set(e.form,"eventPurchase",r)},expression:"form.eventPurchase"}},[t("a-radio",{attrs:{value:1}},[e._v("不限制次数")]),t("a-radio",{attrs:{value:2}},[e._v("限购")])],1),t("a-input-number",{attrs:{placeholder:"自定义",min:1,max:1e3,disabled:1===e.form.eventPurchase||e.disabled},model:{value:e.form.epNumber,callback:function(r){e.$set(e.form,"epNumber",r)},expression:"form.epNumber"}}),e._v("次 ")],1),e.form.restriction.includes(1)?t("a-form-model-item",{attrs:{label:"会员卡是否享受叠加折扣",prop:"superimposed"}},[t("a-radio-group",{attrs:{disabled:e.disabled},model:{value:e.form.superimposed,callback:function(r){e.$set(e.form,"superimposed",r)},expression:"form.superimposed"}},[t("a-radio",{attrs:{value:1}},[e._v("不享受")]),t("span",{staticClass:"tip"},[e._v("如拼团项目100元，会员卡不享受叠加折扣")]),t("br"),t("a-radio",{attrs:{value:2}},[e._v("享受")]),t("span",{staticClass:"tip"},[e._v("如拼团项目100元，会员卡享受叠加折扣，例100元*会员卡折扣")])],1)],1):e._e(),t("a-form-model-item",{attrs:{label:"支付方式",prop:"paymentMethod"}},[t("a-checkbox-group",{attrs:{disabled:e.disabled},model:{value:e.form.paymentMethod,callback:function(r){e.$set(e.form,"paymentMethod",r)},expression:"form.paymentMethod"}},[t("a-checkbox",{attrs:{value:1}},[e._v(" 会员卡 ")]),t("a-checkbox",{attrs:{value:2}},[e._v(" 微信支付 ")])],1)],1),t("a-form-model-item",{ref:"product",attrs:{label:"活动项目",prop:"product"}},[e.form.product.length?e._e():t("a-button",{attrs:{type:"link",disabled:e.disabled},on:{click:e.selectProject}},[e._v("选择项目")]),e.form.product.length?t("a-table",{ref:"table",attrs:{rowKey:"productId",columns:e.columnsProject,dataSource:e.form.product,pagination:!1,size:"small"},scopedSlots:e._u([{key:"titleHeader",fn:function(r,o){return t("span",{},[[t("a-row",{attrs:{align:"middle"}},[t("a-col",{attrs:{span:7}},[t("img",{staticClass:"img-50",attrs:{src:o.productIcon,alt:""}})]),t("a-col",{attrs:{span:14}},[t("div",[e._v(e._s(o.productName))]),t("div",[e._v("¥"+e._s(o.price))])])],1)]],2)}},{key:"action",fn:function(r,o,a){return t("span",{},[[t("a-button",{attrs:{type:"link",disabled:e.disabled},on:{click:function(r){return e.deleteProject(a)}}},[e._v(" 删除 ")])]],2)}}],null,!1,4270841026)}):e._e()],1),t("a-form-model-item",{ref:"groupPrice",attrs:{label:"拼团价",prop:"groupPrice"}},[e.form.product.length?[t("a-input-number",{ref:"groupPrice1",staticStyle:{width:"150px"},attrs:{placeholder:"请输入2-10的整数",min:2,max:10,precision:0,disabled:e.disabled},on:{blur:function(r){return r.stopPropagation(),e.stopPropagation(r)}},model:{value:e.form.peopleNumber,callback:function(r){e.$set(e.form,"peopleNumber",r)},expression:"form.peopleNumber"}}),e._v("人成团，拼团价："),t("a-input-number",{ref:"groupPrice2",attrs:{precision:2,min:.01,disabled:e.disabled},on:{blur:function(){return e.$refs.groupPrice.onFieldBlur()}},model:{value:e.form.groupPrice,callback:function(r){e.$set(e.form,"groupPrice",r)},expression:"form.groupPrice"}})]:[e._v(" 请先选择项目 ")]],2),t("a-form-model-item",{staticClass:"commissary",attrs:{label:"分佣设置",prop:"commissary"}},[e.form.product.length?[t("a-radio-group",{attrs:{disabled:e.disabled},model:{value:e.form.commissary,callback:function(r){e.$set(e.form,"commissary",r)},expression:"form.commissary"}},[t("a-radio",{attrs:{value:1}},[e._v("不分佣")]),t("br"),t("a-radio",{attrs:{value:2}},[e._v("固定比例：")]),e._v("会员支付 "),t("a-input-number",{attrs:{min:0,max:100,disabled:2!==e.form.commissary||e.disabled},model:{value:e.form.pt_huiyuan_pay_bili,callback:function(r){e.$set(e.form,"pt_huiyuan_pay_bili",r)},expression:"form.pt_huiyuan_pay_bili"}}),e._v("%， 微信支付"),t("a-input-number",{attrs:{min:0,max:100,disabled:2!==e.form.commissary||e.disabled},model:{value:e.form.pt_weixin_pay_bili,callback:function(r){e.$set(e.form,"pt_weixin_pay_bili",r)},expression:"form.pt_weixin_pay_bili"}}),e._v("%"),t("br"),t("a-radio",{attrs:{value:3}},[e._v("固定金额：")]),e._v("会员支付 "),t("a-input-number",{attrs:{min:0,max:100,disabled:3!==e.form.commissary||e.disabled},model:{value:e.form.pt_huiyuan_pay_yuan,callback:function(r){e.$set(e.form,"pt_huiyuan_pay_yuan",r)},expression:"form.pt_huiyuan_pay_yuan"}}),e._v("元， 微信支付"),t("a-input-number",{attrs:{min:0,max:100,disabled:3!==e.form.commissary||e.disabled},model:{value:e.form.pt_weixin_pay_yuan,callback:function(r){e.$set(e.form,"pt_weixin_pay_yuan",r)},expression:"form.pt_weixin_pay_yuan"}}),e._v("元 ")],1)]:[e._v(" 请先选择项目 ")]],2)],1),t("SelectStore",{ref:"SelectStore",on:{ok:e.setStoreList}}),t("SelectProject",{ref:"SelectProject",on:{ok:e.setProjectList}})],1)},a=[],i=t("3835"),n=(t("b0c0"),t("d81d"),t("1276"),t("ac1f"),t("a9e3"),t("d3b7"),t("a15b"),t("b64b"),t("a434"),t("f6ef")),s=t("cd3f"),u=t.n(s),l=t("c1df"),c=t.n(l),d=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("BaseModal",{ref:"BaseModal",attrs:{title:"选择门店",showSearch:!1},on:{ok:e.handleOk}},[t("s-table",{ref:"table",attrs:{rowKey:"id",size:"small",columns:e.columns,data:e.loadData,condition:e.condition,showPagination:!1,"row-selection":e.rowSelection,scroll:{y:430}}})],1)},m=[],p=t("1da1"),f=(t("96cf"),t("c593")),b=t("ab09"),_=t("0a99"),h={name:"selectStore",components:{BaseModal:f["a"],STable:b["a"]},data:function(){return{columns:this.$tableConfig.store.columns,condition:this.$tableConfig.store.condition,loadData:function(e){return Object(_["c"])(e)},selectList:[]}},computed:{rowSelection:function(){var e=this;return{onChange:function(r,t){e.selectList=t},getCheckboxProps:function(e){return{props:{disabled:"Disabled User"===e.name,name:e.name}}},selectedRowKeys:this.selectList.map((function(e){return e.id}))}}},created:function(){},mounted:function(){},methods:{handleOk:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:e.$emit("ok",e.selectList);case 1:case"end":return r.stop()}}),r)})))()},open:function(e){this.selectList=e,this.$refs.BaseModal.open()}}},y=h,v=t("2877"),g=Object(v["a"])(y,d,m,!1,null,"10efec6c",null),w=g.exports,x=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("BaseModal",{ref:"BaseModal",attrs:{title:"选择项目",showSearch:!1,showButton:!1}},[t("s-table",{ref:"table",attrs:{rowKey:"productId",size:"small",columns:e.columns,data:e.loadData,condition:e.condition,scroll:{y:400}},scopedSlots:e._u([{key:"titleHeader",fn:function(r,o){return t("span",{},[[t("a-row",{attrs:{align:"middle"}},[t("a-col",{attrs:{span:7}},[t("img",{staticClass:"img-40",attrs:{src:o.productIcon,alt:""}})]),t("a-col",{attrs:{span:14}},[t("div",[e._v(e._s(o.productName))]),t("div",[e._v("¥"+e._s(o.price))])])],1)]],2)}},{key:"action",fn:function(r,o){return t("span",{},[[t("a-button",{attrs:{type:"link"},on:{click:function(r){return e.handleOk(o)}}},[e._v(" 选择 ")])]],2)}}])})],1)},P=[],$={name:"selectProject",components:{BaseModal:f["a"],STable:b["a"]},data:function(){return{columns:this.$tableConfig.product.columns,condition:this.$tableConfig.product.condition,loadData:function(e){return Object(_["b"])(e)}}},created:function(){},mounted:function(){},methods:{handleOk:function(e){var r=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r.$emit("ok",[e]),r.$refs.BaseModal.close();case 2:case"end":return t.stop()}}),t)})))()},open:function(e,r){this.$refs.BaseModal.open()}}},k=$,j=Object(v["a"])(k,x,P,!1,null,"6b0077e4",null),S=j.exports,N=t("807d"),O=t("ca00"),C={components:{BaseCard:n["a"],SelectStore:w,SelectProject:S},props:["record","disabled"],data:function(){return{form:u()(N["defaultForm"]),rules:Object(N["rules"])(this),columnsStore:this.$tableConfig.store.columns,columnsProject:this.$tableConfig.product.columns}},watch:{record:function(e){if(e){var r=e.name,t=e.startTime,o=e.endTime,a=e.groupValid,n=e.stores,s=e.restriction,u=e.eventPurchase,l=e.epNumber,d=e.superimposed,m=e.paymentMethod,p=e.product,f=e.groupPrice,b=e.peopleNumber,_=e.commissary,h=e.mPayment,y=e.wPayment,v=Object(O["e"])(a),g=Object(i["a"])(v,3),w=g[0],x=g[1],P=g[2],$={name:r,pt_huodong_shijian:t&&o?[c()(t),c()(o)]:null,day:w,hour:x,minute:P,stores:n||[],restriction:s.split(",").map((function(e){return Number(e)})),eventPurchase:u,epNumber:l||void 0,superimposed:d,product:p?[p]:[],peopleNumber:b,groupPrice:f,commissary:_?Number(_):0,pt_huiyuan_pay_bili:void 0,pt_weixin_pay_bili:void 0,pt_huiyuan_pay_yuan:void 0,pt_weixin_pay_yuan:void 0,paymentMethod:m.split(",").map((function(e){return Number(e)}))};2===Number(_)?Object.assign($,{pt_huiyuan_pay_bili:h?Number(h):0,pt_weixin_pay_bili:y?Number(y):0}):3===Number(_)&&Object.assign($,{pt_huiyuan_pay_yuan:h?Number(h):0,pt_weixin_pay_yuan:y?Number(y):0}),this.form=$}}},methods:{check:function(){var e=this;return new Promise((function(r){e.$refs.ruleForm.validate((function(t,o){if(t){var a=e.form,i=a.name,n=a.pt_huodong_shijian,s=a.day,u=a.hour,l=a.minute,c=a.stores,d=a.restriction,m=a.eventPurchase,p=a.epNumber,f=a.superimposed,b=a.product,_=a.peopleNumber,h=a.groupPrice,y=a.commissary,v=a.pt_huiyuan_pay_bili,g=a.pt_weixin_pay_bili,w=a.pt_huiyuan_pay_yuan,x=a.pt_weixin_pay_yuan,P=a.paymentMethod,$={name:i,startTime:n[0].format(e.$ds),endTime:n[1].format(e.$ds),groupValid:24*s*60+60*u+l,stores:c,restriction:d.join(),eventPurchase:m,superimposed:f,paymentMethod:P.join(),product:b[0],groupPrice:h,peopleNumber:_,commissary:y};return 2===m&&($.epNumber=p),2===y?Object.assign($,{mPayment:v||0,wPayment:g||0}):3===y&&Object.assign($,{mPayment:w||0,wPayment:x||0}),r($)}return e.$message.error(o[Object.keys(o)[0]][0].message),r(!1)}))}))},stopPropagation:function(e){e.stopPropagation()},setStoreList:function(e){this.form.stores=e,this.$refs.stores.onFieldBlur()},selectStore:function(){this.$refs.SelectStore.open(this.form.stores)},deleteStore:function(e){this.form.stores.splice(e,1)},setProjectList:function(e){this.form.product=e,this.$refs.product.onFieldBlur()},selectProject:function(){this.$refs.SelectProject.open()},deleteProject:function(e){this.form.product.splice(e,1)}}},M=C,q=(t("ccac"),Object(v["a"])(M,o,a,!1,null,"1ea6a1cc",null));r["default"]=q.exports},"9d3e":function(e,r,t){},a15b:function(e,r,t){"use strict";var o=t("23e7"),a=t("44ad"),i=t("fc6a"),n=t("a640"),s=[].join,u=a!=Object,l=n("join",",");o({target:"Array",proto:!0,forced:u||!l},{join:function(e){return s.call(i(this),void 0===e?",":e)}})},ccac:function(e,r,t){"use strict";t("9d3e")}}]);